1 <!DOCTYPE html>
    2 <html>
    3 <head>
    4     <title>Video Sync</title>
    5     <style>
    6         body { font-family: sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px;
      display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    7         #app { width: 95%; max-width: 800px; background-color: #fff; border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
    8         #video-container { position: relative; padding-bottom: 56.25%; height: 0;
      background-color: #000; }
    9         #player, #local-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      }
   10         #local-video, #local-video-controls { display: none; }
   11         #controls, #player-toggle { padding: 15px 20px; }
   12         #controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
   13         input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius:
      4px; min-width: 100px; }
   14         button { padding: 10px 15px; border: none; background-color: #007bff; color: #fff;
      border-radius: 4px; cursor: pointer; }
   15         button:hover { background-color: #0056b3; }
   16         #player-toggle { background-color: #f7f7f7; display: flex; justify-content: center;
      gap: 10px; border-top: 1px solid #eee; }
   17     </style>
   18 </head>
    1 <body>
    2     <div id="app">
    3         <div id="video-container">
    4             <div id="player"></div>
    5             <video id="local-video" controls></video>
    6         </div>
    7         <div id="player-toggle">
    8             <button id="use-youtube">Use YouTube</button>
    9             <button id="use-local">Use Local Video</button>
   10         </div>
   11         <div id="controls">
   12             <div id="youtube-controls">
   13                 <input type="text" id="video-id" placeholder="Enter YouTube Video ID">
   14             </div>
   15             <div id="local-video-controls">
   16                 <input type="file" id="video-file">
   17             </div>
   18             <hr>
   19             <input type="text" id="room-id" placeholder="Enter Room ID">
   20             <button id="create-room">Create Room</button>
   21             <button id="join-room">Join Room</button>
   22         </div>
   23     </div>
   31         function onPlayerReady(event) {}
    32
    33         function onPlayerStateChange(event) {
    34             if (isHost && playerType === 'youtube') {
    35                 socket.emit('player-event', { room: roomId, event: { type: 'stateChange',
       player: 'youtube', data: event.data } });
    36             }
    37         }
    38
    39         useYoutubeBtn.addEventListener('click', () => {
    40             playerType = 'youtube';
    41             youtubeControls.style.display = 'block';
    42             localVideoControls.style.display = 'none';
    43             youtubePlayer.style.display = 'block';
    44             localPlayer.style.display = 'none';
    45         });
    46
    47         useLocalBtn.addEventListener('click', () => {
    48             playerType = 'local';
    49             youtubeControls.style.display = 'none';
    50             localVideoControls.style.display = 'block';
    51             youtubePlayer.style.display = 'none';
    52             localPlayer.style.display = 'block';
    53         });
    54
    55         createRoomBtn.addEventListener('click', () => {
    56             isHost = true;
    57             roomId = Math.random().toString(36).substring(2, 8);
    58             const videoId = videoIdInput.value;
    59             socket.emit('create', { room: roomId, videoId: videoId, playerType: playerType });
    60             roomIdInput.value = roomId;
    61             if (playerType === 'youtube' && videoId) { player.loadVideoById(videoId); }
    62         });
    63
    64         joinRoomBtn.addEventListener('click', () => {
    65             isHost = false;
    66             roomId = roomIdInput.value;
    67             socket.emit('join', roomId);
    68         });
    69
    70         videoFileInput.addEventListener('change', (event) => {
    71             const file = event.target.files[0];
    72             if (file) { localPlayer.src = URL.createObjectURL(file); }
    73         });
    74
    75         ['play', 'pause', 'seeked'].forEach(type => {
    76             localPlayer.addEventListener(type, () => {
    77                 if (isHost) {
    78                     const event = { type: type === 'seeked' ? 'seek' : 'stateChange', player:
       'local' };
    79                     event.data = type === 'play' ? 'play' : (type === 'pause' ? 'pause' :
       localPlayer.currentTime);
    80                     socket.emit('player-event', { room: roomId, event: event });
    81                 }
    82             });
    83         });
    84
    85         socket.on('room-info', (data) => {
    86             if (data.playerType === 'youtube') {
    87                 useYoutubeBtn.click();
    88                 player.loadVideoById(data.videoId);
    89             } else {
    90                 useLocalBtn.click();
    91             }
    92         });
    93
    94         socket.on('get-sync', () => {
    95             if (isHost) {
    96                 const isYoutube = playerType === 'youtube';
    97                 const event = {
    98                     type: 'sync',
    99                     player: playerType,
   100                     data: {
   101                         state: isYoutube ? player.getPlayerState() : (localPlayer.paused ?
       YT.PlayerState.PAUSED : YT.PlayerState.PLAYING),
   102                         time: isYoutube ? player.getCurrentTime() : localPlayer.currentTime
   103                     }
   104                 };
   105                 socket.emit('sync', { room: roomId, event: event });
   106             }
   107         });
   108
   109         socket.on('sync', (event) => {
   110             if (!isHost) {
   111                 const isYoutube = event.player === 'youtube';
   112                 const targetPlayer = isYoutube ? player : localPlayer;
   113                 const seek = isYoutube ? targetPlayer.seekTo : (time) => {
       targetPlayer.currentTime = time; };
   114                 const play = isYoutube ? targetPlayer.playVideo : targetPlayer.play;
   115                 const pause = isYoutube ? targetPlayer.pauseVideo : targetPlayer.pause;
   116
   117                 seek(event.data.time, true);
   118                 if (event.data.state === YT.PlayerState.PLAYING) { play(); }
   119                 else if (event.data.state === YT.PlayerState.PAUSED) { pause(); }
   120             }
   121         });
   122
   123         socket.on('player-event', (event) => {
   124             if (!isHost) {
   125                 const isYoutube = event.player === 'youtube';
   126                 const targetPlayer = isYoutube ? player : localPlayer;
   127                 const seek = isYoutube ? targetPlayer.seekTo : (time) => {
       targetPlayer.currentTime = time; };
   128                 const play = isYoutube ? targetPlayer.playVideo : targetPlayer.play;
   129                 const pause = isYoutube ? targetPlayer.pauseVideo : targetPlayer.pause;
   130
   131                 if (event.type === 'stateChange') {
   132                     if (event.data === YT.PlayerState.PLAYING || event.data === 'play') {
       play(); }
   133                     else if (event.data === YT.PlayerState.PAUSED || event.data === 'pause') {
       pause(); }
   134                 } else if (event.type === 'seek') {
   135                     seek(event..data, true);
   136                 }
   137             }
   138         });
   139     </script>
   140 </body>
   141 </html>
